from OpenGL.GL import *
from OpenGL.GLU import *
import pygame
import sys
from pygame.locals import *

class GameApp3d:
    def __init__(self, a_VeiwPortWidth=1024, a_ViewPortHeight=768, a_Fullscreen=False):
        pygame.init()

        video_options = OPENGL|DOUBLEBUF

        screen = pygame.display.set_mode((a_VeiwPortWidth, a_ViewPortHeight), video_options)

        self.Resize((a_VeiwPortWidth, a_ViewPortHeight))

        glShadeModel(GL_SMOOTH)
        glClearColor(0.0, 0.0, 0.0, 0.0)
        glClearDepth(1.0)
        glEnable(GL_DEPTH_TEST)
        glDepthFunc(GL_LEQUAL)
        glHint(GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST)

    def ProcessEvents(self):
        l_ReturnVal = True

        events = pygame.event.get()
        for event in events:
            if event.type == KEYDOWN:
                if self.ProccessKeys( event.key ) == True:
                    l_ReturnVal = False
            elif event.type == QUIT:
                l_ReturnVal = False

        return l_ReturnVal

    def Resize(self, (width, height)):
        if height==0:
            height=1
        glViewport(0, 0, width, height)
        glMatrixMode(GL_PROJECTION)
        glLoadIdentity()
        gluPerspective(45, 1.0*width/height, 0.1, 100.0)
        glMatrixMode(GL_MODELVIEW)
        glLoadIdentity()

    def ProccessKeys(self, a_Key):
        if a_Key == K_ESCAPE:
            return True

    def Draw(self):
        glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)
        glLoadIdentity()
        pygame.display.flip()

    def Exit(self):
        pygame.quit()
        sys.exit()
